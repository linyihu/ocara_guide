<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>系统应用</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../style/function.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css" />
<script type="text/javascript" src="../treeview/base.js"></script>
<style type="text/css">
<!--
.STYLE4 {
	color: #333333;
	font-weight: bold;
}
.STYLE5 {
	color: #000000;
	font-weight: bold;
}
-->
</style>
</head>
<body><pre>
<h1>系统应用函数</h1>

</pre>
<div class="function">
<pre><strong>1、ocEmpty(content)</strong>
      检查是否为非0的空值。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>content</td>
		<td>必需。要检测的变量</td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
echo ocEmpty(array()); //结果为true 
echo ocEmpty(0);       //结果为false 
echo ocEmpty('0');     //结果为false 
echo ocEmpty(null);    //结果为true
echo ocEmpty(false);   //结果为true 
echo ocEmpty('');      //结果为true
</pre>
<pre><strong>2、ocSql(sql)</strong>
       封装SQL语句。
       由于Model要对sql语句参数进行Sql过滤处理，所以如果不希望当前SQL语句被过滤处理，而是保持原样，就用此函数。
       参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>sql</td>
		<td>必需。SQL语句字符串</td>
	</tr>
</table>
      实例如下：
</pre>
<p>修改商品的点击数字段hits</p>
<pre class="brush: php;">
$where = array('item_id' => 2); 
$data = array(
    'hits'=> ocSql('hits+1')
);

$itemModel = new \Model\Item();
$itemModel->update($where, $data, 1);
//生成的SQL语句中set语句为：set `hits` = hits+1。
</pre> 
<p>然而，没有使用ocSql()函数时，</p>
<pre class="brush: php;">$where = array('item_id' => 2); 
$data = array(
    'hits' => 'hits+1'
);

$itemModel = new \Model\Item();
$itemModel->update($where, $data, 1);
//生成的SQL语句中set语句为：set `hits` = 'hits+1'
//hits+1两边加上了单引号，这样就item_id字段就直接用字符串“hits+1”保存处理而没有执行加1。
</pre>
<pre><strong>3、ocCookie(name, value[, expire, path, domain, secure, httponly])</strong>
      设置cookie。参数跟PHP原生的setcookie函数一致，请看PHP的setcookie函数的介绍。
      只不过，默认值可以在resource/conf/develop.php中<span class="STYLE5">配置COOKIE的相关选项</span>，如下是Web应用刚生成时框架默认的配置：
<pre class="brush: php;">
/*
 * cookie配置
 */
$CONF['COOKIE'] = array(
	'path'		=>  '/', //有效路径
	'domain' 	=> '', //有效域名
	'secure' 	=> 0, //是否使用Https来传输cookie
	'httponly' 	=> 1, //是否禁止Javascript使用该cookie
);
</pre>	  
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>name</td>
		<td>必需。规定 cookie 的名称。</td>
	</tr>
		<tr>
		<td>value</td>
		<td>必需。规定 cookie 的值。。</td>
	</tr>
		<tr>
		<td>expire</td>
		<td>可选。规定 cookie 的有效期。</td>
	</tr>
		<tr>
		<td>path</td>
		<td>可选。规定 cookie 的服务器路径。<span class="STYLE4">默认是使用COOKIE的path配置</span>，如果不存在该配置则在当前目录有效。<br/>
如果该参数设为 '/' 的话，cookie 就在整个 domain 内有效，如果设为 '/foo/'，cookie 就只在 domain 下的 /foo/ 目录及其子目录内有效，例如 /foo/bar/。默认值为设定 cookie 的当前目录。</td>
	</tr>
		<tr>
		<td>domain</td>
		<td>可选。规定 cookie 的域名。<span class="STYLE5">默认是使用COOKIE的domain配置</span>，如果不存在该配置则在当前域有效。例如，要使 cookie 能在如 example.com 域名下的所有子域都有效的话，该参数应该设为 '.example.com'。</td>
	</tr>
	<tr>
		<td>secure</td>
		<td>可选。规定是否通过安全的 HTTPS 连接来传输 cookie。<span class="STYLE5">默认是使用COOKIE的secure配置</span>，默认为0表示False，指不使用HTTPS传输。为True时，cookie 仅在安全的连接中被设置。如果不存在该配置则为False。</td>
	</tr>
	<tr>
		<td>httponly</td>
		<td>可选。规定是否禁止Javascript使用该cookie。<span class="STYLE5">默认是使用COOKIE.httponly配置</span>，如果没有该配置，则为True，表示禁止。<br/>
	  为了防止JS中的Session劫持，防止XSS攻击，<strong>建议对于关键的cookie将该参数设置为true</strong>。</td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
//设置username变量，其他参数使用COOKIE的相关配置。
ocCookie('username', 'Jim');

//设置username，其他参数自定义，在未来一天内的ocara.cn根目录下有效
ocCookie('username', 'Tom', 86400, '/', '.ocara.cn');
</pre> 

<pre><strong>4、ocGlobal(name[, value])</strong>
     设置或获取框架虚拟的全局变量。
     只是虚构的全局变量，不是真正的全局变量，而是Ocara类的$_GLOBALS属性的键值。
     本框架是纯面向对象的开发方式，为了防止全局变量的不良使用习惯，导致安全问题，所以虚构了全局变量。如果要使用全局变量，建议用该函数。
     <span class="STYLE5">如果设置了value参数，则表示设置全局变量，否则表示获取全局变量值。</span>
     参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>name</td>
		<td>必需。全局变量名称。</td>
	</tr>
	<tr>
		<td>value</td> 
		<td>可选。如果是设置全局变量，则需传递该参数作为值。 </td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
//设置全局变量
ocGlobal('username', 'Jim');

//获取全局变量值
$username = ocGlobal('username');
</pre>
<pre><strong>5、ocLang(name[, params, default])</strong>
      获取多语言变量的配置。这些语言配置的配置文件都在Web应用目录的resource/lang目录下。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>name</td>
		<td>必需。多语言变量名称。</td>
	</tr>
	<tr>
		<td>params</td> 
		<td>可选。参数数组。</td>
	</tr>
	<tr>
		<td>default</td> 
		<td>可选。设置默认值。如果不存在该变量配置，则可传递该参数来返回默认值。</td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
//假设已经设置了username为用户名
$usernameDesc = ocLang('username'); //返回“用户名”

//如果没有设置username的语言配置
$usernameDesc = ocLang('username', array(), '登录用户名'); //因为不存在配置，所以返回默认值“登录用户名”

//如果设置了not_exists_username变量，其语言配置成：用户名%s不存在。
$username = 'Jim';
$error = ocLang('not_exists_username', array($username)); //返回：用户名Jim不存在

//如果设置了not_exists_username变量，其语言配置成：用户名{username}不存在。
$username = 'Jim';
$error = ocLang('not_exists_username', array('username' => $username)); //依然返回：用户名Jim不存在

</pre>
<pre><strong>6、ocConfig(name[, default, unempty])</strong>
      获取配置。除了语言配置，其他所有的配置文件在当前应用的resource/conf下面。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>name</td>
		<td>必需。配置名称，其实就是$CONF的键名。如果是多级键名，可以为键名数组或圆点分隔的键名。</td>
	</tr>
		<tr>
		<td>default</td>
		<td>可选。如果配置不存在，并且指定了该参数，则会返回该参数作为默认值；如果也没有指定该参数，则会抛出错误提示。</td>
	</tr>
		<tr>
		<td>unempty</td>
		<td>可选。默认为false。如果为true，表示函数的返回值不能为空。此时如果配置数组中没有该变量的配置或者配置值为非0的空值（空字符串、false或null），则会返回default参数值</td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
//不提定默认值
echo ocConfig('COOKIE.path'); //存在path的配置，返回其值
echo ocConfig('COOKIE.path_test'); //如果不存在path_test的配置，不返回值，而是抛出错误提示

//指定配置变量不存在时的默认值
echo ocConfig('COOKIE.path_test', '/'); //如果不存在path_test的配置，不报错，而是返回默认值'/'

//提定变量配置不存在或者配置值为空时的默认值
echo ocConfig('COOKIE.path_test', '/', true); //如果不存在path_test的配置，不报错，而是返回默认值'/'
echo ocConfig('COOKIE.path', '/', true); //假设存在配置path，其值为非0的空值，则这里也不报错，而是返回默认值'/'

</pre> 


<pre><strong>7、ocDie(content)</strong>
      停止代码执行。即die()函数的重写。如果加入自定义回调，还可以在停止执行前执行回调代码。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>content</td>
		<td>要输出的变量</td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
ocDie('die content');
</pre>
<pre><strong>8、ocPrint(content)</strong>
      使用print_r()打印内容，并且停止代码执行。用于代码暂停式的调试。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>content</td>
		<td>要使用print_r()函数打印的内容。</td>
	</tr>
</table>
      实例如下：
</pre>
<pre class="brush: php;">
ocPrint(array(0)); //输出Array ( [0] => 0 )
</pre> 
<pre><strong>9、ocDump(content)</strong>
      使用var_dump()打印内容，并且停止代码执行。也用于代码暂停式的调试。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>content</td>
		<td>要使用var_dump()函数打印的内容。</td>
	</tr>
</table>
     实例如下：
</pre>
<pre class="brush: php;">
var_dump(array(0)); //输出array(1) { [0]=> int(0) }
</pre> 
<pre><strong>10、ocReplaceSpace(string[, replace])</strong>
      替换空白字符，如回车或换行、制表符或空格等。
      参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>string</td>
		<td>必需。要替换空白的原字符串。</td>
	</tr>
		<tr>
		<td>string</td>
		<td>可选。要将空白字符替换的字符。如果不指定，则替换为空字符串，也就是去除空白。</td>
	</tr>
</table>
     实例如下：
</pre>
<pre class="brush: php;">
echo ocReplaceSpace("aa|t\t", "<br/>"); //将结尾的制表符“\t”替换成“<br/>”，变成“aa|t<br/>”

echo ocReplaceSpace("aa|t\t"); //去掉结尾的制表符“\t”，变成"aa|t"
</pre> 
</div>
</body>
</html>
