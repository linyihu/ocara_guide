<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>系统配置</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
</head>
<body>
<pre><h2>系统配置</h2>

<strong>一、配置介绍</strong>
       配置分为三种：
       （1）全局配置
                指的是全局性配置，任何时候和地方都能使用。控制器、数据模型和视图都能用。
        （2）控制器配置
                指的是仅限当前模块、控制器和动作Action使用的配置。
       （3）数据模型Model的配置。
                指的是数据模型Model使用到的配置，一般用于配置字段在验证规则、字段别名、连接查询等。
<strong>二、配置目录介绍</strong>
       系统配置目录是<strong>resource/conf</strong>目录，全站所有的配置一般都放在该目录下面，除了多语言配置外，因为多语言配置是resource/lang目录。
       1、配置目录结构说明
                配置目录中有以下子目录和文件，具体介绍如下：
       （1）控制器配置（control目录）
                该目录用于控制器配置，是当前MVC（模块、控制器或动作）从上到下自定义的配置，其中的子目录是与MVC路由同名的目录。
                <strong>（a）当前MVC配置目录中的配置只有当前MVC中有效，不会影响其他MVC。</strong>
                比如，admin模块目录中的配置只在该模块下的控制器或动作中有效，其他模块不会加载这些配置。控制器和动作目录类似。
                <strong>（b）下级目录中的配置会覆盖上级目录中的同名配置。</strong>
                如下实例：
<img src="../style/images/control配置实例.png" />
                如上图所示，目录结构说明如下：
                       （a）在admin模块下面有test.php配置文件和item控制器目录
                       （b）item控制器目录中有一个test2.php和edit动作目录
                       （c）edit动作目录有一个test2.php和test子目录
                       （c）test子目录中保存了一个test3.php配置文件
                假设这些配置文件都配置了$CONF['LOG.root']。
                那么，ItemController控制器中使用该配置时，用到的是item/test2.php中配置的有效。
                而EditAction动作中用到的是item/edit/test2.php的配置，它覆盖了下上层目录item/test2.php中的同名配置。
                同时，item/edit/test/test3.php的配置则没有用到。
       （2）数据模型的配置（model目录）
                该目录是数据模型的配置，其目录结构与application/model中一致。
                每个数据模型在其中都有相应的配置文件。子目录与数据库服务器同名。
       （3）全局配置
                框架默认在新建应用时都默认生成了以下配置文件，其中的配置任何控制器动作都有效，除非在control控制器配置中覆盖了，配置内容不允许删除。
              （a）应用级配置（application.php）
                       该文件是应用级配置。
                       所谓应用级配置，是指修改这些配置不影响系统代码和功能。
                       特别有利于开源系统开发，因为可以允许站长修改其中配置。
              （b）开发级配置（develop.php）
                       该文件是开发级配置。
                       所谓的开发级配置，是指这些配置是代码开发要用的，只能由当前程序开发人员修改，否则会影响代码运行。
              （c）数据库配置（database.php）
                       这里是数据库配置，可以复制$CONF['DATABASE']['default']新增新的服务器配置。
                       如果要数据库服务器太多，配置文件写得太乱，可以使用自定义回调，具体的请参看<a href="../数据模型层/数据库设置.html">数据库设置</a>的第4（2）点。
              （d）缓存配置（cache.php）
                       这里是缓存的配置。一般用于Memcache和Redis等缓存的构建。
              （e）静态生成规则配置（static.php）
                       这是在网站进行纯静态生成时用到的生成规则配置，请参见<a href="静态生成.html">静态生成</a>一节。
              （f）自定义回调配置（callback.php）
                       所有的<a href="自定义回调.html">自定义回调</a>都在该文件。具体的回调介绍，在手册相应地方会有说明。
              （g）新增配置文件
                       除了上述基本的配置文件以外，我们还可以在该目录新增全局性的配置文件，所有的控制器动作都能使用。
       2、配置文件的加载顺序
              首先，框架在运行应用时，会先加载配置目录conf下的全局配置文件。
              其次，会加载控制器配置目录conf/control中的配置文件。
              再次，会依次加载conf/control目录中子目录（模块、控制器和动作）的配置。
              另外，在新建数据表模型时，会加载数据表模型配置目录中的配置文件。如下说明：
                       （a）如果数据表模型的数据库连接是default，则会加载conf/model目录中的配置文件
                       （b）如果使用的是另外的数据库服务器，比如bbs服务器，数据库配置为$CONF['DATABASE']['bbs']，则会加载conf/model/bbs下的所有配置文件

<strong>三、如何写配置</strong>
       1、注意配置数组的键名
              写系统配置，主要是针对$CONF配置数组。有以下两点注意：
                    （1）配置时，是按该数组元素来一个个配置，千万不能用$CONF = array() 格式。
                    （2）$CONF的一维元素键名必须全为大写字母，而其子数组键名没这样要求，原则上都用小写。
              比如，拿表单配置来说，表单键名FORM，而其子数组配置的键名都是小写。
              我们可以在conf/develop.php中看到它的默认配置，如下所示：
<pre class="brush: php;">
/*
 * 表单配置
 */
$CONF['FORM'] = array(
	'use_token' 		=> 0, 						//是否使用表单令牌
	'token_tag' 		=> '_temp_ocform_token',	//表单令牌隐藏域名称
	'invalid_callback' 	=> '', 						//表单令牌非法时回调函数(表单来源非法时的提示)
	'validate_callback' => ''						//表单验证失败时回调函数(验证出错时的提示)
);
</pre>
       2、同一级目录中同一个配置选项只能写在一个地方
              由于同一级目录中配置文件的加载顺序不定，同一级目录下的同一个配置，应该只在同一个文件中出现一次。
              比如$CONF['LOG.root']一般是在conf/develop.php中配置，就不要在其他文件写了（例如conf/application.php），conf的子目录中是可以的，因为不在同一层目录中。

<strong>四、如何获取配置</strong>
       获取配置，要使用ocConfig()函数，请参见<a href="../函数智能/系统应用.html">函数智能/系统应用函数</a>中ocConfig函数的使用。
       另外，有些配置可以设置回调函数来获取，比如数据库配置的自定义回调，请参见<a href="../数据模型层/数据库设置.html">数据库设置</a>一节。
</pre>
</body>
</html>
