<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Session处理</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../style/function.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
</head><body><pre><h2>Session保存方式</h2>

Ocara支持文件、数据库和缓存三种保存方式，也提供了session操作插件。

<strong>（1）文件保存方式</strong>
    需要关闭数据库保存，并且自定义文件保存路径。
    比如要保存在cache/my_sessions
    只要修改配置文件/required/conf/develop.php：
<pre class="brush: php;">/*
 * session配置
 */
$CONF['SESSION'] = array(
	'save_type'	 => 1, //session保存方式，1为自定义文件类型，2为数据库类型，3为缓存类型
	'save_time'	 => 0, //session的最长存活时间（单位为秒）
	'server'     => '', //服务器名称，因为是文件保存方式，所以这里为空即可
	'location'	 => 'cache/sessions', //保存session的文件目录名
);</pre>
        说明：
            （a）配置项“save_type”为1；
            （b）配置项“location”为session的保存目录，默认是cache/sessions，上级目录规定是required/data。
<strong>（2）数据库保存方式</strong>
    需要开启数据库保存，指定保存的数据表名。
    比如要保存到my_sessions表中，
    修改配置文件/required/conf/develop.php：
<pre class="brush: php;">
/*
 * session配置
 */
$CONF['SESSION'] = array(
	'save_type'	 => 2, //session保存方式，1为自定义文件类型，2为数据库类型，3为缓存类型
	'save_time'	 => 0, //session的最长存活时间（单位为秒）
	'server'     => 'default', //服务器名称，数据库服务器名称或Redis服务器名
	'location'	 => 'my_sessions', //保存session的数据表名
);</pre>
        说明：
            （a）配置项“save_type”设为2；
            （b）配置项“server”，即保存session的数据库服务器名称，这里使用默认为default；
            （c）配置项“location”为保存session的数据表名，默认为ocsess

<strong>（3）缓存保存方式</strong>
    需要缓存支持。
    先要装好Memcache或Redis等缓存后，并在/required/conf/cache.php配置好缓存选项。
    假设使用$CONF['CACHE']['cache_redis']的话，修改配置文件/required/conf/develop.php：
<pre class="brush: php;">
/*
 * session配置
 */
$CONF['SESSION'] = array(
	'save_type'	 => 3, //session保存方式，1为自定义文件类型，2为数据库类型，3为缓存类型
	'save_time'	 => 0, //session的最长存活时间（单位为秒）
	'server'     => 'cache_redis', //服务器名称，数据库服务器名称或Redis服务器名
	'location'	 => 'sessions', //保存session的缓存前缀，缓存前缀
);</pre>
        说明：
            （a）配置项“save_type”设为3；
            （b）配置项“server”，即保存session的缓存服务器名称，这里使用cache_redis，默认为default；
            （c）配置项“location”为保存session的缓存前缀，默认为sessions


<h2>Session操作方式</h2>

<strong>（1）直接用$_SESSION</strong>
    如：
<pre class="brush: php;">$login_info = $_SESSION['login_info'];</pre>
    或者，
<pre class="brush: php;">$login_info = ocGet('login_info', $_SESSION);</pre>
<strong>（2）使用插件Session（推荐）</strong>
     调用代码：
    （a）模块、控制器或动作action的代码中可以使用$this->session调用，如：
	<pre class="brush: php;">
$login_info = $this->session->get('login_info'); 
	</pre>
    （b）静态调用方式
<pre class="brush: php;">
$login_info = Session::get('login_info');
</pre>

<h2>Session插件方法函数介绍</h2>

<div class="function">
<pre><strong>1、get(name)</strong>
   获取session值。  
  参数说明：
 </pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>name</td>
		<td>必需。变量名称，如果为空，则返回$_SESSION整个数组。</td>
	</tr>
	</table>  
  实例如下：
 <pre class="brush: php;">
 $login_info = $this->session->get('login_info'); </pre>
<pre><strong>2、set(name, value)</strong>
  设置session值。  
  参数说明：
 </pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>name</td>
		<td>必需。变量名称。如果为键值数组，则将键名作为变量名，键值作为变量值</td>
	</tr>
		<tr>
		<td>value</td>
		<td>必需。变量值</td>
	</tr>
	</table>  
  实例如下：
（1）设置is_login为true
<pre class="brush: php;">
  $this->session->set('is_login', true); </pre>
  批量设置is_login为true，设置user_name为user1
<pre class="brush: php;">
$this->session->set(array(
	'is_login' => true,
	'user_name' => 'user1'
));
</pre>
  <pre><strong>3、delete(name)</strong>
   删除session变量。  
  参数说明：
 </pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>name</td>
		<td>必需。变量名称。</td>
	</tr>
	</table>  
  实例如下：
 <pre class="brush: php;">
 $this->session->delete('login_info'); </pre>
<strong>4、getId()</strong>
  获取session ID。 
  实例如下：
 <pre class="brush: php;">
 $sessionId = $this->session->getId(); </pre>
 <strong>5、getName()</strong>
  获取session名称。  
  实例如下：
 <pre class="brush: php;">
 $sessionName = $this->session->getName();; </pre>
<strong>6、clear()</strong>
  清空session。
  实例如下：
 <pre class="brush: php;">
 $this->session->clear(); </pre>
<pre><strong>7、exists(name)</strong>
  检测是否设置了某个session变量。  
  参数说明：
 </pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>name</td>
		<td>必需。变量名称。</td>
	</tr>
	</table>  
  实例如下：
 <pre class="brush: php;">
if ($this->session->exists('user_name')) {
	echo true;
} else {
	echo false;
}
</pre>
<strong>8、destroy()</strong>
  释放session。
  实例如下：
 <pre class="brush: php;">
 $this->session->destroy(); </pre>
<strong>9、setSaveTime(saveTime)</strong>
  设置session有效期(单位为秒)。 
  实例如下：
 <pre class="brush: php;">
 $this->session->setSaveTime(86400); </pre>
<pre><strong>10、setCookie(saveTime[, path, domain, secure, httponly])</strong>
  保存session到cookie。参数类似于setcookie()原生函数。  
  参数说明：
 </pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>saveTime</td>
		<td>必需。cookie保存时间。</td>
	</tr>
		<tr>
		<td>path</td>
		<td>可选。有效目录。</td>
	</tr>
		<tr>
		<td>domain</td>
		<td>可选。有效域名。</td>
	</tr>
		<tr>
		<td>secure</td>
		<td>可选。安全参数。</td>
	</tr>
    		<tr>
		<td>httponly</td>
		<td>可选。安全参数，默认为true。为防注入，建议保持为true。</td>
	</tr>
	</table>  
  实例如下：
 <pre class="brush: php;">
 $login_info = $this->session->setCookie(86400); </pre>
<strong>11、serialize()</strong>
  序列化session数组。  
  实例如下：
 <pre class="brush: php;">
 $sessionString = $this->session->serialize(); </pre>
<pre><strong>12、unserialize(data)</strong>
  反序列化session字符串。  
  参数说明：
 </pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>data</td>
		<td>必需。要反序列化的session字符串。</td>
	</tr>
	</table>  
  实例如下：
 <pre class="brush: php;">
 $session = $this->session->unserialize($sessionString); </pre>
</div>
</pre>
</body></html>
