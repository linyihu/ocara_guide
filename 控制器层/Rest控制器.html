<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Rest模块</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../style/function.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
</head><body><pre><h2>Rest模块的使用</h2>

        应用生成时默认在application/library/Base目录中生成了CommonModule.php和RestModule.php两个控制器文件。
        Rest控制器都要继承RestModule。

<strong>1、如何添加Rest模块</strong>
        只要在开发者中心添加模块时，选择Rest模块即可。

<strong>2、如何配置路由</strong>
        （1）配置说明
                框架默认的rest路由配置如下：
<pre class="brush: php;">
/*
 * Restful路由规则
 */
'CONTROLLERS' => array(
    'rest' => array(

        'id_param'     => 'id', //ID参数名称
        'content_type' => 'json', //返回数据类型

        //路由映射
        'action_map' => array(
            'GET' 			=> 'index', //获取记录列表
            'GET/id' 		=> 'view', //获取记录详情
            'POST' 			=> 'create', //添加记录
            'PUT/id' 		=> 'update', //更新记录
            'PATCH/id' 		=> 'update', //更新记录
            'HEAD' 			=> 'index', //获取记录列表
            'HEAD/id' 		=> 'view', //获取记录详情
            'DELETE/id'		=> 'delete', //删除记录
        ),
        //请求成功返回状态码
        'success_code_map' => array(
            'index' 	=> 200, //获取记录列表成功
            'create' 	=> 201, //添加记录成功
            'view' 		=> 200, //获取记录详情成功
            'update' 	=> 200, //更新记录成功
            'delete' 	=> 204, //删除记录成功
        ),
    )
),
</pre>
                详细说明：
                        （1）id_param，指定传递的ID参数名称。
                        （2）content_type，指定RESTFUL返回结果的数据类型，小写，默认为json。
                        （3）action_map，指定路由映射方式。带“/id”表示需要带上ID参数。
                        （4）success_code_map，指定请求成功后返回的HTTP状态码。
        （2）修改配置
                如果要修改Rest路由，只要在develop.php中修改相关KEY即可。

<strong>3、如何自定义返回数据格式</strong>
        框架提供了自定义返回格式的方式，就是修改控制器动作的方法函数formatAjaxResult()。
        Rest返回数据，使用的是Ajax方式，Ajax返回结果数组包括以下键值。
                （1）status，处理状态，一般包括success和failed两个值，这个不需要修改。
                （2）code，处理错误码，如果处理成功时为0。
                （3）message，处理结果描述。
                （4）body，处理后的结果数据。

        假设要设置item控制器的返回数据格式，那么formatAjaxResult()代码格式，应该如下：
<pre class="brush: php;">
namespace app\modules\index\item;

use app\modules\index\Module;
use dal\models\main\Item;

class Controller extends Module
{
    public function formatAjaxResult()
    {
        if ($result['status'] == 'success') {
            //这里修改请求成功时返回的数据格式

            //返回result的body值
            return $result['body'];
        } else {
            //这里修改请求失败时返回的数据格式

            //返回全部值
            return $result;
        }
    }
}
</pre>



</pre>
</body></html>
