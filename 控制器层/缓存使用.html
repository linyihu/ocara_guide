<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>缓存使用</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
<style type="text/css">
<!--
.STYLE1 {
	color: #0000FF;
	font-weight: bold;
}
-->
</style>
</head>

<body><pre><h2>缓存使用</h2>

</pre>

<pre>

<strong>1、缓存配置和调用</strong>
      框架默认已支持Memcache和Redis。除了增加了统一的setVar()和getVar()方法，其他的方法函数可使用原生缓存对象的。
      （1）缓存配置
               必须有open和type两个配置选项。键名即缓存别名。
               如下是框架默认的MemCache和Redis的缓存配置，默认的是main缓存。
<pre class="brush: php;">
/*
 * 缓存配置
 */

return array(
    'CACHE' => array(
        /*
         * 默认缓存（名称不可更改）
         */
        'main' => array(
            'open' 		=> 0, //是否启用
            'type' 		=> 'memcache',
            'servers' 	=> array(
                array('127.0.0.1', 11211)
            ),
        ),

        /*
         * Redis缓存
         */
        'redis1' => array(
            'open' 		=> 0, //是否启用
            'type' 		=> 'redis',
            'host'		=> '127.0.0.1',
            'password'	=> '6379'
        )
    ),
);
</pre>
      （2）调用缓存
               调用缓存用\Ocara\Core\CacheFactory的create()方法。
               比如上述配置的两个缓存，调用如下：
<pre class="brush: php;">
use \Ocara\Core\CacheFactory;

//调用默认的缓存（main）
$mem = CacheFactory::create();

//调用Redis缓存
$redis = CacheFactory::create('redis1');
</pre>

<strong>3、缓存扩展</strong>
         如果框架的缓存类不满足需求，可以安装好缓存扩展或程序之后，新建自定义的缓存类。
        （1）安装缓存和扩展
        （2）新建缓存类
                 该缓存类必须继承基类CacheBase和缓存接口Cache。
                 1）缓存接口Cache
                         缓存类必须设置$_plugin属性，它保存的是缓存类实例。
                         比如Redis的$_plugin属性就是new Redis()的对象，并且必须含有set()和get()两个方法。
                         接口代码如下：
<pre class="brush: php;">
interface Cache
{
	/**
	 * 析构函数
	 * @param array $config
	 * @param bool $required
	 */
	public function __construct($config, $required = true);

	/**
	 * 设置KEY
	 * @param string $name
	 * @param boolean $value
	 * @return bool
	 */
	public function set($name, $value);

	/**
	 * 获取KEY
	 * @param string $name
	 */
	public function get($name);

	/**
	 * 删除KEY
	 * @param string $name
	 */
	public function delete($name);
}
</pre>
                 2）缓存基类CacheBase
                         定义了默认的方法.
<pre class="brush: php;">
class CacheBase extends Base
{
	protected $_slaves = array();
}
</pre>
</pre>
</body>
</html>
