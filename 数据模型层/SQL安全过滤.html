<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>SQL安全过滤</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
<style type="text/css">
<!--
.STYLE1 {color: #FF0000}
.STYLE2 {color: #00CC33}
-->
</style>
</head>

<body>
<pre>
<h2>SQL安全过滤处理</h2>

       框架为了安全起见，在使用数据模型Model的<a href="SQL语句生成.html">SQL语句生成函数</a>生成SQL语句时，会对SQL语句自动进行安全过滤：
<strong>（1）过滤哪些文本</strong>
         对于SQL语句关键部分，框架会执行以下两种处理：
        （a）SQL关键字过滤
                 对于条件数组或者要保存的数据数组，使用Ocara\Core\Filter的sql()静态方法对其元素值进行sql关键字安全过滤和引号转义。
                 会去除SQL字符串中的insert、update、delete等关键字。
       （b）引号转义
                对英文单引号、双引号等都进行转义。Mysql数据库，会调用mysql_real_escape_string()进行转义。  
<strong>（2）SQL过滤函数
       </strong> 如果要手动进行SQL过滤，也可以使用Ocara\Core\Filter的sql()。
        sql(content)
        参数说明：
</pre>
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
		<tr>
		<td>content</td>
		<td>必需。sql字符。</td>
	</tr>
</table>

<pre class="brush: php;">
$userModel= new \app\dal\models\User();
$userModel->select(1); //获取主键为1的记录数据
$userModel->email = ocService()->filter->sql('newEmail@163".com'); //手动过滤，修改email

$extraData = array(
    'create_time' => time(),
);

$userModel->save($extraData); //更新记录，会合并属性设置和$extraData的数据
</pre>

<pre>

<h2>哪些情形会过滤</h2> 

数据模型Model进行SQL过滤的情形，如下所示：
<strong>（1）进行安全过滤的情况</strong>
       （a）where()的条件为字段数组时，其字段值会进行sql安全过滤；
       （b）使用where()作复杂条件时，其条件参数为字符串时会进行过滤，若为字段数组时，也对该字段值进行sql安全过滤。
       （c）使用save()、create()和update()时，添加或修改的字段值会进行SQL安全过滤。
<strong>（2）不进行安全过滤的情况</strong>
       （a）where()的条件参数为字符串时；
       （b）使用orderBy()时；
       （c）使用groupBy()时。

<h2>如何取消SQL安全过滤</h2>
     
     请参考<a href="如何使用原生的sql语句.html">如何使用原生的SQL语句</a>。
</pre>
</body>
</html>
