<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>事务处理</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
<style type="text/css">
    <!--
    .STYLE1 {
        color: #0000FF;
        font-weight: bold;
    }
    -->
</style>
</head>

<body><pre><h2>事务处理</h2>

<strong>1、事务的使用</strong>
    事务处理要使用数据库连接对象实例的相关方法。
    一般用Model或它的数据库对象获取。
    在本框架中，如果某个类继承了\Ocara\Base，则它的_plugin属性所保存的插件对象的方法可以为它所用。
    因为模型的数据库对象保存在它的_plugin属性，所以它可以调用这的数据库对象的方法。
    因此，事务处理的方法都可以通过模型调用，也可以使用它的数据库对象。
    也就是说$userModel->transCommit()与$userModel->db()->transCommit()等价，前提时$userModel没有重写transCommit()方法。
    事务处理中，有以下几个方法使用。
      （1）事务开始
           使用数据库或模型的transBegin()方法。该方法格式如下：
                  <span class="STYLE1">transBegin()</span>
           实例：
<pre class="brush: php;">$userModel= new \Model\User();

//实例（1）使用Model的db()方法获取
$userModel->transBegin();

//实例（2）使用Database::factory()获取
Database::factory()->transBegin();
</pre>
      （2）事务提交
           使用数据库或模型的transCommit()方法。该方法格式如下：
                  <span class="STYLE1">transCommit()</span>
           实例：
<pre class="brush: php;">$userModel= new \Model\User();
$userModel->transBegin();
$userModel->create();
$userModel->transCommit();
</pre>
       （3）事务回滚
            使用数据库或模型的transRollback()方法。该方法格式如下：
                  <span class="STYLE1">transRollback()</span>
            实例：
<pre class="brush: php;">$userModel= new \Model\User();
$userModel->transBegin();
$userModel->create();
$userModel->transRollback();
</pre>

</pre></body>
</html>
