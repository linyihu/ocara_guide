<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>跨页表单生成</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../style/function.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
<style type="text/css">
<!--
.STYLE1 {
	color: #0000FF;
	font-weight: bold;
}
-->
</style>
</head>

<body><pre><h2>跨页表单的生成</h2>
    表单令牌一节已经说明了表单新建时都有一个唯一的令牌标识，如果表单令牌提交前后不一致，会导致表单过期错误。
    当前页面表单大多提交到当前控制器动作中。
    但是，有时候是提交到另外的控制器动作，这种情况称为跨页。
    对于这种情况，因为不是同一个控制器动作，所以表单有可能因为控制器动作名称不同而表单令牌不一致，会抛出表单过期错误。
    解决办法是在提交后的动作中表单生成时使用<span class="STYLE1">setRoute()</span>指定为原表单的动作名。

<pre>
   实例如下：
   （1）新建表单页
<pre class="brush: php;">class CreateshowAction extends ItemController
{
    //初始化代码
	public function __action()
	{}
	
	//新建表单
    public function registerForms()
	{
		$this->form('form_item_edit') 
			->init(ocUrl('/admin/item/createpost')) //提交到另外的控制器动作;
	}

	//这里写页面显示前的逻辑...
	public function display()
	{}
}
</pre>
   （2）提交到另外的另一个控制器动作处理
       处理动作代码如下实例：
<pre class="brush: php;">class CreatepostAction extends ItemController
{
    //初始化代码
	public function __action()
	{}

	//新建表单
    public function registerForms()
	{
		$this->form('form_item_edit')
			->model('\Model\Item')
			->setRoute('item/createshow');  //设置表单的路由为原表单页面的控制器动作路由
	}

	//这里写表单提交后的代码...
	public function submit()
	{
		$itemModel = new \Model\Item();
		$itemModel->data()->save();
	}
}
</pre>
</pre>
</body>
</html>
