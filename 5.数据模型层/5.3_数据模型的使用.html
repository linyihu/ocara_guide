<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>5.3 数据模型的使用</title>
<script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
<script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
<link type="text/css" rel="stylesheet" href="../style/base.css" />
<link type="text/css" rel="stylesheet" href="../style/function.css" />
<link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
<script type="text/javascript" src="../treeview/base.js"></script>
</head>
<body>
<pre><h2>5.3 数据模型（Model）</h2>

<strong>1、新建模型</strong>
      新建模型有两种方法：
      （1）直接新建Model类。
      （2）使用Model类的build()方法。
      （3）使用控制器动作的model()方法，用于建立默认的Model。

<strong>2、详细说明</strong>
      （1）直接新建Model类

<pre class="brush: php;">
//新建User模型类实例
$userModel = new \app\model\database\UserModel();

//新建BBS数据库连接下面的User模型类实例
$userModel = new \app\model\database\BBS\UserModel();

</pre>
      （2）使用build()方法
          本框架所有的类，都继随自\Ocara\Base基类，该基类定义了build()方法，可以新增当前对象。

<pre class="brush: php;">
//会新建application/model下面的User模型类实例
$userModel = \app\model\database\User::build();

//会新建application/model/BBS下面的User模型类实例
$userModel = \app\model\database\BBS\User::build();
</pre>
      （3）使用控制器动作的model()方法
           使用model()方法建立的模型，后面都可以用该方法函数直接获取。默认是当前控制器同名的模型。
                  <span class="function"><strong>model([class])</strong></span>
             参数说明：
<table>
	<tr class="head">
		<td width="90">名称</td>
		<td width="400">描述</td>
	</tr>
	<tr>
		<td>class</td>
		<td>可选。数据模型类。默认是当前控制器同名的模型。
		</td>
	</tr>
</table>
             上述实例可以改成如下：
<pre class="brush: php;">
$userModel = $this->model('\app\model\database\UserModel');
</pre>
             如果是bbs服务器默认库中的user表，则是：
<pre class="brush: php;">
$userModel = $this->model('\app\model\database\BBS\UserModel'); //会调用bbs数据库连接的目录中的User模型
</pre>
             如下示例：
<pre class="brush: php;">
class UpdateAction extends Controller
{
	public function __action()
	{}

	/**
	 * 初始化
	 */
	public function display()
	{
        //用户表Model使用
		$userData = $this
                ->model('\app\model\database\UserModel') //第一次使用时，会新建该模型类对象
                ->limit(0, 100)
                ->getAll();

        //用户表Model使用
        $userData2 = $this
                ->model('\app\model\database\UserModel') //第二次使用，不会再新建类
                ->limit(0, 100)
                ->getAll();

        //home表Model使用
        $homeData = $this
            ->model() //因为home表模型名与控制名称同名，可以不传递参数建立模型
            ->limit(0, 100)
            ->getAll();
	}

    /**
     * 表单提交的处理
     */
	public function submit()
	{}
}
</pre>
 <strong>3、如何切换数据库和数据表（分库分表）？</strong>
      如果数据库要进行分库，方法如下：
      首先在Model类内部使用用_sharding()定义分库规则，然后外部调用sharing()方法传递分库规则要使用的具体数据，就可以进行分库。
      而在_sharding()中，可以使用selectDatabase()和selectTable()切换数据库和表。
      请参考<a href="5.12_分库分表.html">5.12_分库分表</a>。

</pre></body></html>
