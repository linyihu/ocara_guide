<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>通道的使用</title>
    <script type="text/javascript" src="../syntax/scripts/shCore.js"></script>
    <script type="text/javascript" src="../syntax/scripts/shBrushPhp.js"></script>
    <link type="text/css" rel="stylesheet" href="../style/base.css" />
    <link type="text/css" rel="stylesheet" href="../syntax/styles/shCoreDefault.css"/>
    <script type="text/javascript" src="../treeview/base.js"></script>
    <style type="text/css">
        <!--
        .STYLE1 {
            color: #0000FF;
            font-weight: bold;
        }
        -->
    </style>
</head>
<body alink=#ff0000>
<pre><h2>通道（pass目录）的使用</h2>

     通道是用于绕过单入口的限制而独立出来的目录通道，里面的PHP文件可以直接HTTP访问。
     一般用于引入第三方程序，比如论坛系统或支付系统等。

    <strong>1、通道目录</strong>
         通道目录，是当前Web应用中public/pass目录。
         该目录需要手动在Web根目录新建。

    <strong>2、通道文件的执行</strong>
         通道使用时很简单，直接访问其中的PHP文件即可。比如：http://localhost/pass/test.php。

    <strong>3、调用控制器动作</strong>
        如果要在通道中的PHP文件调用某个控制器动作，可使用Invoke类。
        具体步骤如下：
           （1）正确加载Invoke类文件
           （2）调用<span class="STYLE1">Invoke::init()</span>初始化框架
                 <span class="STYLE1">init(rootPath, fileSelf)</span>
      参数说明：
</pre>
<table>
    <tr class="head">
        <td width="90">名称</td>
        <td width="400">描述</td>
    </tr>
    <tr>
        <td>rootPath</td>
        <td>必填。当前Web应用目录。即public的上层目录。</td>
    </tr>
    <tr>
        <td>fileSelf</td>
        <td>必填。当前文件路径，一般只要传递“__FILE__”即可。</td>
    </tr>
</table>
<pre>
           （3）调用<span class="STYLE1">Invoke::run()</span>方法执行控制器动作
                  其中，根目录的路径尽量使用<span class="STYLE1">dirname()</span>生成的相对路径，考虑到兼容性。

    <strong>4、实例</strong>
                  如下实例，在pass目录中的test.php中调用user/view控制器动作，并传递id=13参数，
                  （a）文件路径截图
                  <img src="../style/images/通道使用实例.png" alt="通道使用实例"/>

                  （b）pass/test.php中调用代码：
<pre class="brush: php;">
/**
 * User: Administrator
 * Date: 16-4-27
 */

//加载Invoke文件
require_once dirname(__DIR__) . '/ocara/system/library/Core/Invoke.php';

//初始化框架
Ocara\Invoke::init(dirname(dirname(__DIR__)), __FILE__);

//执行控制器动作
Ocara\Invoke::run('/user/view', array('id' => 13));

</pre>
                  （b）执行文件
                         浏览器中执行文件：http://localhost/ocapp/pass/test.php。
                         如果要用PHP命令执行，参见<a href="./PHP命令执行.html">PHP命令执行</a>中的实例。
</pre></body></html>
